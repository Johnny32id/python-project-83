{% extends 'index.html' %}

{% block main %}

    <h1>Сайт: <span class="text-break" style="max-width: 500px; display: inline-block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ url.name }}">{{ url.name }}</span></h1>
    <div class="table-responsive">
        <table class="table table-bordered table-hover"
               data-test="url">
            <tbody>
            <tr>
                <td>ID</td>
                <td>{{ url.id }}</td>
            </tr>
            <tr>
                <td>Имя</td>
                <td class="text-break" style="max-width: 500px; word-break: break-all;">{{ url.name }}</td>
            </tr>
            <tr>
                <td>Дата создания</td>
                <td>{{ url.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
            </tr>
            </tbody>
        </table>
    </div>
    <h3 class="mt-3 mb-3">Проверки</h3>
    <form method="post" action="{{ url_for('add_url_check', id=url.id) }}" id="check-form">
        <input type="submit" class="btn btn-primary" value="Запустить проверку" id="check-btn">
        <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true" id="check-spinner"></span>
        <span class="ms-2 d-none" id="check-status">Выполняется проверка...</span>
    </form>

    {% if checks %}
    <div class="table-responsive">
        <table class="table table-bordered table-hover mt-2"
               data-test="checks">
            <thead>
            <tr>
                <th>ID</th>
                <th>Код ответа</th>
                <th>h1</th>
                <th>title</th>
                <th>description</th>
                <th>Дата создания</th>
            </tr>
            </thead>
            <tbody>
            {% for check in checks %}
            <tr>
                <td>{{ check.id }}</td>
                <td>{{ check.status_code }}</td>
                <td>
                    {% if check.h1 %}
                        <span style="max-width: 200px; display: inline-block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ check.h1 }}">{{ check.h1 }}</span>
                    {% else %}
                        <span class="text-muted">—</span>
                    {% endif %}
                </td>
                <td>
                    {% if check.title %}
                        <span style="max-width: 200px; display: inline-block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ check.title }}">{{ check.title }}</span>
                    {% else %}
                        <span class="text-muted">—</span>
                    {% endif %}
                </td>
                <td>
                    {% if check.description %}
                        <span style="max-width: 200px; display: inline-block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ check.description }}">{{ check.description }}</span>
                    {% else %}
                        <span class="text-muted">—</span>
                    {% endif %}
                </td>
                <td>{{ check.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info mt-3" role="alert">
        <h4 class="alert-heading">Нет проверок</h4>
        <p class="mb-0">Запустите первую проверку, нажав кнопку выше.</p>
    </div>
    {% endif %}

    <script>
        document.getElementById('check-form').addEventListener('submit', function() {
            const btn = document.getElementById('check-btn');
            const spinner = document.getElementById('check-spinner');
            const status = document.getElementById('check-status');
            
            btn.disabled = true;
            btn.value = 'Проверка...';
            spinner.classList.remove('d-none');
            status.classList.remove('d-none');
        });
    </script>

{% endblock %}